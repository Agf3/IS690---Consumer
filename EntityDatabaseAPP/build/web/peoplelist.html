<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>People List</title>
<meta http-equiv="Content-Type" content="text/html; charset=uft-8" />
<link rel="stylesheet" type="text/css" href="css/common.css" />
<link rel="stylesheet" type="text/css" href="css/popform.css" />
<link type="text/css" href="./jqueryui180/css/redmond/jquery-ui-1.8.10.custom.css" rel="stylesheet" />	
<link rel="stylesheet" type="text/css" href="css/jqui_mod.css" />
<script type="text/javascript" src="./jqueryui180/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="./jqueryui180/js/jquery-ui-1.8.10.custom.min.js"></script>
<!-- JS_DECLARE_START - DO NOT REMOVE-->
<script type="text/javascript" src="./rest/Support.js"></script>
<!-- JS_DECLARE_END - DO NOT REMOVE-->
</head>
<body>
<!--header part begin-->
<div id="Header">
	<h1>
    	<a href="orghome.html" target="_self"><img src="img/zzzzhome.png" width="50" height="50" alt="Home Logo" /></a>
    </h1>
    <div id="navigation" class="ui-tabs">
    	<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
        	<li class="ui-state-default ui-corner-top menu"><a href="#">People Management</a><a class="submenu1 border-style1" id="create" href="#">Create People</a></li>
            <li class="ui-state-default ui-corner-top menu"><a href="eventlist.html">Event Management</a></li>
        </ul>
    </div>
</div>
<!--header part end-->
<!--body part begin-->
<div id="mainBody" class="ui-accordion">
        <div id="messageField" style="height:25px; width: 100%; margin-bottom: 10px; text-align: center;">
               <span id="messageBox" style="background-color:#FBF9EA; padding: 5px; display: none;"></span>
        </div>
    
	<div id="content">
        <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-corner-all" role="tab" aria-expanded="false"><span class="ui-icon ui-icon-triangle-1-e"></span><a href="#" style="padding-left:1.7em;" tabindex="-1">People List</a></h3>
        
<!--        <table width="100%" border="0" cellpadding="10" cellspacing="10" id="pListTable">
            <tr class="border-style1">
                <th>First Name</th><th>Last Name</th><th>Email</th><th>Phone</th><th>Action</th>
            </tr>
            <tr class="border-style1">
                <td>aa</td><td>bb</td><td>abc@ip.com</td><td>1234567890</td><td><a href="#" class="edit">Edit</a>&nbsp;&nbsp;<a href="#" class="delete">Delete</a></td>
            </tr>
            <tr class="border-style1">
                <td>aa</td><td>bb</td><td>abc@ip.com</td><td>1234567890</td><td><a href="#" class="edit">Edit</a>&nbsp;&nbsp;<a href="#" class="delete">Delete</a></td>
            </tr>
            <tr class="border-style1">
                <td>aa</td><td>bb</td><td>abc@ip.com</td><td>1234567890</td><td><a href="#" class="edit">Edit</a>&nbsp;&nbsp;<a href="#">Delete</a></td>
            </tr>
            <tr class="border-style1">
                <td>aa</td><td>bb</td><td>abc@ip.com</td><td>1234567890</td><td><a href="#" class="edit">Edit</a>&nbsp;&nbsp;<a href="#">Delete</a></td>
            </tr>
            <tr class="border-style1"><td>aa</td><td>bb</td><td>abc@ip.com</td><td>1234567890</td><td><a href="#" class="edit">Edit</a>&nbsp;&nbsp;<a href="#">Delete</a></td></tr>
        </table>-->
        <div id="peoplelist"></div>
        <p style="margin-top:20px;"><a href="#" id="add_people" class="ui-state-default ui-corner-all dialog_link"><span class="ui-icon ui-icon-newwin"></span>Add</a></p>
    </div>    
    <div id="sideBar">
  	 <form method="post" action="#">
        <fieldset class="ui-corner-all">
          <legend>Login</legend>
          <label>User name:</label><br />
          <input type="text" size="20" name="name" />
          <br />
          <label>Password:</label><br />
          <input type="password" size="20" name="password" />
          <br />
          <br />
          <input type="submit" value="Login" />
          <input type="reset" value="Reset" />
        </fieldset>
      </form>
   	<p style="margin-top:20px;"><a href="#" id="create_user" class="ui-state-default ui-corner-all dialog_link"><span class="ui-icon ui-icon-newwin"></span>Create a new account</a></p>
  	</div> 
  
  <div class="blankfix"></div>
</div>
<!--body part end-->
<!--foot part begin-->
<div id="Foot">
  <div class="clearfix">
    <p>Powered by Dali.</p>
  </div>
</div>
<!--foot part end-->
 <!-- ui-dialog -->
		<div id="dialog_add" title="Personal Information">
			<form class="popForm" name="addPeopleForm" id="addPeopleForm" action="#">
            	<dl>
                	<dt>First Name:</dt>
                    <dd><input type="text" width="30" name="form_add_fname" id="form_add_fname" /></dd>
                    <dt>Last Name:</dt>
                    <dd><input type="text" width="30" name="form_add_lname" id="form_add_lname" /></dd>
                    <dt>Phone:</dt>
                    <dd><input type="text" width="30" name="form_add_phone" id="form_add_phone" /></dd>
                    <dt>Email:</dt>
                    <dd><input type="text" width="30" name="form_add_email" id="form_add_email" /></dd>
                </dl>
            </form>
		</div>
        
    <!-- ui-dialog -->
		<div id="dialog_update" title="Personal Information">
			<form class="popForm" name="updatePeopleForm" id="updatePeopleForm" action="#">
            	<dl>
                	<dt>First Name:</dt>
                    <dd><input type="text" width="30" value="default" name="form_update_fname" id="form_update_fname" /></dd>
                    <dt>Last Name:</dt>
                    <dd><input type="text" width="30" value="default" name="form_update_lname" id="form_update_lname" /></dd>
                    <dt>Phone:</dt>
                    <dd><input type="text" width="30" value="1234567890" name="form_update_phone" id="form_update_phone" /></dd>
                    <dt>Email:</dt>
                    <dd><input type="text" width="30" value="default@default.com" name="form_update_email" id="form_update_email" /></dd>
                </dl>
            </form>
		</div>
<!-- ui-dialog -->
		<div id="dialog_register" title="New User Information">
			<form class="popForm" name="registerForm" id="registerForm" action="#">
            	<dl>
                	<dt>User Name:</dt>
                    <dd><input type="text" width="30" /></dd>
                    <dt>Password:</dt>
                    <dd><input type="password" width="30" /></dd>
                	<dt>First Name:</dt>
                    <dd><input type="text" width="30" /></dd>
                    <dt>Last Name:</dt>
                    <dd><input type="text" width="30" /></dd>
                    <dt>Phone:</dt>
                    <dd><input type="text" width="30" /></dd>
                    <dt>Email:</dt>
                    <dd><input type="text" width="30" /></dd>
                </dl>
            </form>
		</div>  
<script type="text/javascript">
var baseURL = "http://localhost:8080/EntityDatabaseDAL/entity/person/";

function reInitialize(target){
        $.getJSON(baseURL+'list/all/', function(data) {
            refreshlist(data, target);

            $('a.edit').click(function(){
                document.currentEntityId = this.getAttribute("value");
                
                if (data.length > 0) {
                  for(i=0;i<data.length;i++) {
                    var item = data[i];
                    if(item.EntityId == document.currentEntityId){
                        $('#form_update_fname').val(item.FirstName);
                        $('#form_update_lname').val(item.LastName);
                        $('#form_update_email').val(item.Email);
                        $('#form_update_phone').val(item.Phone);

                        $('#dialog_update').dialog('open');
                    }
                  }
                }
//another implementation
//                $.getJSON(baseURL+entityId, function(item) {
//                    $('#form_update_fname').val(item.FirstName);
//                    $('#form_update_lname').val(item.LastName);
//                    $('#form_update_email').val(item.Email);
//                    $('#form_update_phone').val(item.Phone);
//                })
                return false;
            });

            $('a.delete').click(function(){
                var entityId = this.getAttribute("value");
                var rowNum=this.parentNode.parentNode.rowIndex;
                $.ajax({
                  url: baseURL+entityId,
                  type: 'DELETE',
                  success: function(msg){
                      document.getElementById('pListTable').deleteRow(rowNum);
                      $('#messageBox').html(msg);
                      $('#messageBox').show();
                      window.setTimeout("$('#messageBox').fadeOut('slow');", 2000);
                  }
                });
                    
                    
            });
        });
}

function refreshlist(resources, target){
        //table head
        var str = '<table width="100%" border="0" cellpadding="10" cellspacing="10" id="pListTable">';
        str += '<tr class="border-style1">';
        str += '<th>First Name</th><th>Last Name</th><th>Email</th><th>Phone</th><th>Action</th>';
        str += '</tr>';
         
          var items  = resources;
          if (items != undefined) {
            if (items.length > 0) {

              for(j=0;j<items.length;j++) {
                str += '<tr class="border-style1">';
                var item = items[j];
                str += '<td>'+item.FirstName+'</td>';
                str += '<td>'+item.LastName+'</td>';
                str += '<td>'+item.Email+'</td>';
                str += '<td>'+item.Phone+'</td>';
                str += '<td>';
                
                str += '<a href="#" class="edit" value="'+item.EntityId+'">'+'Edit'+'</a>&nbsp;&nbsp;';
                str += '<a href="#" class="delete" value="'+item.EntityId+'">'+'Delete'+'</a>';
                str += '</td>';
                str += '</tr>';
              }
            } else {
              str += '<tr class="border-style1"><td colspan="5">No items detected</td></tr>';
            }
          } else {
            str += '<tr class="border-style1"><td colspan="5">No items, please check the url: <a href="'+uri+'" target="_blank">'+uri+'</a>.<br/>Set proxy if RESTful web service is not running on the same domain as this application.</td></tr>';
          }

        str += '</table>';

        target.innerHTML = str;
}

$(document).ready(function(){
/*Data init part*/
        var target = document.getElementById('peoplelist');
        document.currentEntityId = null;

        reInitialize(target);

/*Dialog init part*/
// New User Dialog			
        $('#dialog_register').dialog({
                autoOpen: false,
                width: 600,
                modal:true,
                buttons: {
                        "Submit": function() {
                                //do data submition function here
                                $(this).dialog("close");
                        },
                        "Reset": function() {
                                //reset form here
                                document.getElementById("registerForm").reset();
                        }
                }
        });

// Add Dialog			
        $('#dialog_add').dialog({
                autoOpen: false,
                width: 600,
                modal:true,
                buttons: {
                        "Submit": function() {
                            var content = '{"FirstName":"' + $('#form_add_fname').val();
                                content += '", "LastName":"'+$('#form_add_lname').val();
                                content += '", "Phone":"'+$('#form_add_phone').val();
                                content += '", "Email":"'+$('#form_add_email').val();
                                content += '"}';
                                //send the get request
                                $.ajax({
                                  url: baseURL,
                                  type: 'PUT',
                                  contentType: 'application/json',
                                  processData: false,
                                  data: content,
                                  success: function(msg){
                                      reInitialize(target);
                                      $('#messageBox').html(msg);
                                      $('#messageBox').show();
                                      window.setTimeout("$('#messageBox').fadeOut('slow');", 2000);
                                  }
                                });

                                //another implementation
                                //rjsSupport.put(baseURL, "application/json", content);
                                reInitialize(target);

                                $(this).dialog("close");
                        },
                        "Reset": function() {
                                document.getElementById("addPeopleForm").reset();
                        }
                }
        });

// Update Dialog			
        $('#dialog_update').dialog({
                autoOpen: false,
                width: 600,
                modal:true,
                buttons: {
                        "Update": function() {
                                var content = '{"FirstName":"' + $('#form_update_fname').val();
                                    content += '", "LastName":"'+$('#form_update_lname').val();
                                    content += '", "Phone":"'+$('#form_update_phone').val();
                                    content += '", "Email":"'+$('#form_update_email').val();
                                    content += '"}';

                                //send the get request
                                if(document.currentEntityId){
                                    $.ajax({
                                      url: baseURL+document.currentEntityId,
                                      type: 'POST',
                                      contentType: 'application/json',
                                      processData: false,
                                      data: content,
                                      success: function(msg){
                                          reInitialize(target);
                                          $('#messageBox').html(msg);
                                          $('#messageBox').show();
                                          window.setTimeout("$('#messageBox').fadeOut('slow');", 2000);
                                          
                                      }
                                    });
                                    document.currentEntityId = null;
                                }
                                
                                $(this).dialog("close");
                        }
                }
        });


        // New User Dialog Link
        $('#create_user').click(function(){
                $('#dialog_register').dialog('open');
                return false;
        });

        // Add Dialog Link
        $('#add_people').click(function(){
                $('#dialog_add').dialog('open');
                return false;
        });

        $('a#create').click(function(){
                $('#dialog_add').dialog('open');
                return false;
        });
  
				
});
</script>
</body>
</html>